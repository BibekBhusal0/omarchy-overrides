#!/usr/bin/env bash
# Obsidian vault search script, i will use this until i find way to intrigate it with walker

vaultlist="$HOME/.config/obsidian/obsidian.json"

if [[ -f "$vaultlist" ]]; then
    # Extract the vault path from the JSON file
    VAULT=$(jq -r '.vaults | to_entries | .[0].value.path' "$vaultlist")
else
    echo "No vault found" >&2
    exit 1
fi

default="$1"
relative_file=$(fd --extension md --type file --strip-cwd-prefix --base-directory="$VAULT" | fzf --prompt="Vault search> " --query="$default")
[[ -z "$relative_file" ]] && exit 0
full_path="$VAULT/$relative_file"

setsid obsidian "obsidian://open?path=$full_path" >/dev/null 2>&1 &
sleep 1
